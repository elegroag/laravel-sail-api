var D=Object.defineProperty;var v=i=>{throw TypeError(i)};var q=(i,t,e)=>t in i?D(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var k=(i,t,e)=>q(i,typeof t!="symbol"?t+"":t,e),T=(i,t,e)=>t.has(i)||v("Cannot "+e);var c=(i,t,e)=>(T(i,t,"read from private field"),e?e.call(i):t.get(i)),u=(i,t,e)=>t.has(i)?v("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),x=(i,t,e,n)=>(T(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e);var y,w,b;class S{constructor(t={}){u(this,y,null);u(this,w,null);u(this,b,null);_.extend(this,t),this.currentViews=new Array,this.el=t.el}show(t){this.closeView(this.currentView),this.currentView=t,this.openView(t)}html(t){this.$el&&this.$el.html(t)}append(t){this.currentViews.push(t),this.ensureEl(),t.render(),this.$el.append(t.el),t.onShow&&t.onShow()}closeView(t){t&&t.remove&&t.remove()}openView(t){this.ensureEl(),t.render(),this.$el.html(t.el),t.onShow&&t.onShow()}ensureEl(){this.$el||(this.$el=$(this.el))}remove(){this.currentViews.length>0&&this.currentViews.forEach(t=>{this.closeView(t)}),this.closeView(this.currentView)}}y=new WeakMap,w=new WeakMap,b=new WeakMap;const d=(()=>{let i,t,e,n;return{hide:(o=!1)=>{o&&t.remove(),i&&e.remove(),i=void 0},show:(o=!1,a)=>{o&&(t=document.createElement("div"),t.setAttribute("id","loading_msj"),$(t).html("<div class='loading_msj'><p class='text-warning'>Procesando datos de busqueda...</p></div>"),document.getElementById("app").appendChild(t)),i||(n=_.template($("#tmp_loader").html()),e=document.createElement("div"),e.setAttribute("class","loader"),e.setAttribute("id","loader"),$(e).append(n()),document.body.appendChild(e),e.setAttribute("style","display:block"),_.isObject(a)===!0&&a.addClass&&$(".loader").addClass(a.addClass)),i=!0}}})(),R=$("[name='csrf-token']"),B={path:R.attr("path"),app:R.attr("app")},g={Models:{},Collections:{},router:null,currentSubapp:null,Modal:null,layout:null,el:null,mainRegion:null,startApp(i,t="",e=""){this.el=e,this.el===""&&(this.el="#contentView"),this.initialize(),this.router=new i,Backbone.history.start()||this.router.navigate(t,{trigger:!0})},initialize(){_.extend(this,Backbone.Events),["error","warning","success","info"].forEach(t=>{this.listenTo(this,`noty:${t}`,e=>this.notify(t,e)),this.listenTo(this,`alert:${t}`,e=>this.alert(t,e))}),this.listenTo(this,"confirma",this.confirmaApp),this.listenTo(this,"syncro",this.syncroRequest),this.listenTo(this,"ajax",this.ajaxKumbia),this.listenTo(this,"show:modal",this.renderModal),this.listenTo(this,"hide:modal",this.closeModal),this.listenTo(this,"down",this.downLoadFile),this.listenTo(this,"upload",this.uploadFile)},notify(i,t){this.showNoty(i,t.toString(),i==="error"?1e4:6e3)},alert(i,t){const{title:e="Notificación",message:n="Nota no hay respuesta de la solicitud",timer:s=8200}=t;this.showAlert(e,n,i,s)},showNoty(i,t,e){new Noty({text:t,layout:"topRight",theme:"relax",type:i,timeout:e}).show()},showAlert(i="",t="",e="",n){Swal.fire({title:i,html:t,icon:e,showConfirmButton:!1,confirmButtonText:"Continuar",timer:n})},startSubApplication(i,t,e={}){let n=[];return typeof t!="string"&&(_.isArray(t)===!0?_.each(t,s=>{n[s.name]=new s.inyectar}):_.isObject(t)===!0?n[t.name]=new t.inyectar:n.push(t)),this.mainRegion=new S({el:this.el,...e}),this.currentSubapp=new i({region:this.mainRegion,services:n,App:this}),this.currentSubapp},confirmaApp(i){const{message:t,callback:e,title:n="¿Confirmar?",icon:s="warning"}=i;Swal.fire({title:n,text:t,icon:s,showCancelButton:!0,confirmButtonColor:"#2dce89",cancelButtonColor:"#fc8c72",confirmButtonText:"SI, Continuar!"}).then(l=>{e(l.isConfirmed)})},syncroRequest(i){const{url:t,data:e={},callback:n,silent:s=!1}=i,l=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({type:"POST",dataType:"json",url:t,data:e,cache:!1,contentType:"application/x-www-form-urlencoded",processData:!0,timeout:52400,beforeSend:o=>{s==!1&&d.show(),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.length>0&&o.setRequestHeader("Authorization","Bearer "+l)},success:o=>(s==!1&&d.hide(),n(o)),error:o=>{const a=_.keys(o);return s==!1&&d.hide(),_.indexOf(a,"responseText")!==-1?(console.log(o.responseText),this.trigger("alert:error",{message:o.responseText})):(console.log(o),this.trigger("alert:error",{message:o})),n(!1)}})},renderModal(i={}){const{title:t,view:e,options:n=!1}=i,s=$("#modalComponent");this.Modal||(this.Modal=new bootstrap.Modal(document.getElementById("modalComponent"),{keyboard:!0,backdrop:"static"})),s.find("#mdl_set_title").text(t),s.find("#mdl_set_footer").css("display","none"),n&&s.find(".modal-dialog").addClass(n.bootstrapSize),s.find("#mdl_set_body").html(e.render().$el),this.Modal.show(),n&&(this.Modal.on("hidden.bs.modal",l=>e.remove()),s.find(".close").addClass("d-none"))},closeModal(i){this.Modal&&(this.Modal.hide(),this.Modal=null),i&&i.remove()},url(i="",t=void 0){return this.kumbiaURL((t??"")+"/"+i)},kumbiaURL:i=>(_.isUndefined(i)===!0&&(i=""),B.path+i),ajaxKumbia(i={}){const{url:t,data:e={},callback:n,silent:s=!1}=i,l=document.querySelector("[name='csrf-token']").getAttribute("content");$.ajax({type:"POST",data:e,url:this.kumbiaURL(t),dataType:"html",processData:!0,contentType:"application/x-www-form-urlencoded",cache:!1,beforeSend:o=>{s==!1&&d.show(),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.length>0&&o.setRequestHeader("Authorization","Bearer "+l)}}).done(o=>(s==!1&&d.hide(),n(o))).fail(o=>(s==!1&&d.hide(),this.trigger("alert:error",{message:o.responseText}),n(!1))).always(()=>{s==!1&&d.hide()})},downLoadFile(i){const{url:t,filename:e}=i,n=document.createElement("a");n.href=this.kumbiaURL(t+"/"+e),n.download=e,console.log(n),n.click()},uploadFile(i){const{url:t,data:e,callback:n,silent:s=!1}=i;let l;e instanceof FormData?l=e:(l=new FormData,l.append(e.name,e.file));const o=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({url:t,type:"POST",dataType:"json",data:l,cache:!1,contentType:!1,processData:!1,beforeSend:a=>{s==!1&&d.show(),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.length>0&&a.setRequestHeader("Authorization","Bearer "+o)},success:a=>(s==!1&&d.hide(),n(a)),error:a=>{const m=_.keys(a);return console.log(a),s==!1&&d.hide(),_.indexOf(m,"responseText")!==-1?this.trigger("alert:error",{message:a.responseText}):this.trigger("alert:error",{message:a}),n(!1)}})}};class E extends Backbone.View{constructor(e={modelDOM:null,onRender:null}){super(e);k(this,"modelDOM",null);this.modelDOM=e.modelDOM||Backbone.Model,this.template=null,_.extend(this,e),this.onRender=_.isFunction(this.onRender)?this.onRender:null}render(){const e=this.serializeData();let n;return _.isFunction(this.template)?n=this.template(e):_.isString(this.template)&&(n=this.compileTemplate()(e)),this.$el.html(n),this.onRender&&this.onRender(this.$el),this}compileTemplate(){if(_.isString(this.template)===!0){const e=document.querySelector(this.template);return _.template(e.innerHTML)}return!1}serializeData(){let e=null;return this.modelDOM!==null?this.model instanceof this.modelDOM?e=this.model.toJSON():typeof this.model=="object"&&(e=this.model):typeof this.model=="object"&&(e=this.model),e||{}}getInput(e){return this.$el.find(`[name='${e}']`).val()}getInputById(e){return this.$el.find("#"+e).val()}setInput(e,n){return this.$el.find(`[name='${e}']`).val(n??"")}getInputByTag(e,n){return this.$el.find(`[${e}='${n}']`).val()}getCheck(e){return this.$el.find(`[name='${e}']:checked`).length}getInputFile(e){return this.$el.find("#"+e).files[0]}}var r;class C extends E{constructor(e={}){super({...e,className:"row",onRender:()=>this.__afterRender()});u(this,r,null);this.template=_.template(document.getElementById("tmp_formulario").innerHTML),x(this,r,e.App||g)}get events(){return{"click #btEnviarRegistro":"sendNotify","keydown #nota":"keydownNoty","keydown .note-editable":"keydownNoty","paste .note-editable":"keydownNoty","contextmenu .note-editable":"keydownNoty"}}__afterRender(){this.$el.find("#nota").summernote({lang:"es-ES",disableDragAndDrop:!0,shortcuts:!1,placeholder:"Agregar los detalles a notificar",toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["insert",["link"]],["para",["ul","ol","paragraph"]],["view",["fullscreen","codeview"]],["table",["table"]]],tabsize:2,tabDisable:!1,height:100,lineHeights:["1","1.5"],callbacks:{onPaste:function(e){e.preventDefault()},onKeyDown:function(e){e.ctrlKey&&e.keyCode===86&&e.preventDefault()},onChange:(e="")=>{const n=e.replace(/'/g,'"');this.$el.find("#nota").val(n)}}}),$.extend(!0,$.summernote.lang,{"es-ES":{examplePlugin:{exampleText:"Ejemplo Texto",dialogTitle:"Ejemplo Plugin",okButton:"OK"}}})}sendNotify(e){e.preventDefault();let n=this.$el.find(e.currentTarget);n.attr("disabled",!0);let s=0;const l=this.$el.find("#servicio").val(),o=this.$el.find("#telefono").val(),a=this.$el.find("#nota").summernote("code"),m=this.$el.find("#novedad").val(),p=document.getElementById("archivo").files;if(a==""&&(this.$el.find("#nota-error").text("La notificación es requerida."),this.$el.find("#nota-error").attr("style","display:inline-block"),s++),o==""&&(this.$el.find("#telefono-error").text("El teléfono o celular de contacto es un valor requerido."),this.$el.find("#telefono-error").attr("style","display:inline-block"),s++),p.length>0&&(this._handleFile("archivo")||(this.$el.find("#archivo-error").text("El archivo no posee un formato valido, solo se admiten: imagenes, word o pdf"),this.$el.find("#archivo-error").attr("style","display:inline-block"),s++)),s>0)return n.removeAttr("disabled"),c(this,r).trigger("alert:warning",{message:"Se requiere de resolver los campos requeridos para continuar."}),setTimeout(()=>{$("label.error").text("")},1e4),!1;const h=new FormData;h.append("servicio",l),h.append("telefono",o),h.append("nota",a),h.append("novedad",m),p.length>0?h.append("file",p[0]):h.append("file",!1),c(this,r).trigger("confirma",{message:"¿Está seguro de envíar el reporte.?",callback:M=>{if(M){const A=c(this,r).url("procesarNotificacion");c(this,r).trigger("upload",{url:A,data:h,callback:f=>{n.removeAttr("disabled"),f&&f.success===!0?c(this,r).trigger("alert:success",{message:f.msj}):c(this,r).trigger("alert:error",{title:"Notificación de error",message:f.msj}),this.$el.find("#servicio").val(""),this.$el.find("#telefono").val(""),this.$el.find("#novedad").val(""),this.$el.find("#archivo").val(""),this.$el.find("#nota").val(""),this.$el.find("#nota").summernote("code","")}})}else n.removeAttr("disabled")}})}_handleFile(e){const n=document.getElementById(e);if(n.files.length==0)return!1;const s=/(.*?)\.(docx|doc|pdf|jpeg|jpg|png|gif)$/i,l=n.files[0].name;return s.exec(l)?!0:(n.value="",!1)}keydownNoty(e){e.ctrlKey&&e.key==="v"&&(e.preventDefault(),c(this,r).trigger("alert:warning",{message:"Disculpas seño@r usuario. No está disponible la opción de pagar contenido de una fuente no confiable. Por favor, redacta los hechos e incidentes presentados durante el proceso de gestión."}))}}r=new WeakMap;$(()=>{g.initialize();const i=new C({App:g});new S({el:"#boneLayout"}).show(i)});
//# sourceMappingURL=Notificaciones.js.map
