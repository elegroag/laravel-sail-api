var b=t=>{throw TypeError(t)};var u=(t,e,o)=>e.has(t)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,o);var f,h,m;class y{constructor(e={}){u(this,f,null);u(this,h,null);u(this,m,null);_.extend(this,e),this.currentViews=new Array,this.el=e.el}show(e){this.closeView(this.currentView),this.currentView=e,this.openView(e)}html(e){this.$el&&this.$el.html(e)}append(e){this.currentViews.push(e),this.ensureEl(),e.render(),this.$el.append(e.el),e.onShow&&e.onShow()}closeView(e){e&&e.remove&&e.remove()}openView(e){this.ensureEl(),e.render(),this.$el.html(e.el),e.onShow&&e.onShow()}ensureEl(){this.$el||(this.$el=$(this.el))}remove(){this.currentViews.length>0&&this.currentViews.forEach(e=>{this.closeView(e)}),this.closeView(this.currentView)}}f=new WeakMap,h=new WeakMap,m=new WeakMap;const r=(()=>{let t,e,o,s;return{hide:(i=!1)=>{i&&e.remove(),t&&o.remove(),t=void 0},show:(i=!1,l)=>{i&&(e=document.createElement("div"),e.setAttribute("id","loading_msj"),$(e).html("<div class='loading_msj'><p class='text-warning'>Procesando datos de busqueda...</p></div>"),document.getElementById("app").appendChild(e)),t||(s=_.template($("#tmp_loader").html()),o=document.createElement("div"),o.setAttribute("class","loader"),o.setAttribute("id","loader"),$(o).append(s()),document.body.appendChild(o),o.setAttribute("style","display:block"),_.isObject(l)===!0&&l.addClass&&$(".loader").addClass(l.addClass)),t=!0}}})(),p=$("[name='csrf-token']"),C={path:p.attr("path"),app:p.attr("app")},c={Models:{},Collections:{},router:null,currentSubapp:null,Modal:null,layout:null,el:null,mainRegion:null,startApp(t,e="",o=""){this.el=o,this.el===""&&(this.el="#contentView"),this.initialize(),this.router=new t,Backbone.history.start()||this.router.navigate(e,{trigger:!0})},initialize(){_.extend(this,Backbone.Events),["error","warning","success","info"].forEach(e=>{this.listenTo(this,`noty:${e}`,o=>this.notify(e,o)),this.listenTo(this,`alert:${e}`,o=>this.alert(e,o))}),this.listenTo(this,"confirma",this.confirmaApp),this.listenTo(this,"syncro",this.syncroRequest),this.listenTo(this,"ajax",this.ajaxKumbia),this.listenTo(this,"show:modal",this.renderModal),this.listenTo(this,"hide:modal",this.closeModal),this.listenTo(this,"down",this.downLoadFile),this.listenTo(this,"upload",this.uploadFile)},notify(t,e){this.showNoty(t,e.toString(),t==="error"?1e4:6e3)},alert(t,e){const{title:o="Notificación",message:s="Nota no hay respuesta de la solicitud",timer:a=8200}=e;this.showAlert(o,s,t,a)},showNoty(t,e,o){new Noty({text:e,layout:"topRight",theme:"relax",type:t,timeout:o}).show()},showAlert(t="",e="",o="",s){Swal.fire({title:t,html:e,icon:o,showConfirmButton:!1,confirmButtonText:"Continuar",timer:s})},startSubApplication(t,e,o={}){let s=[];return typeof e!="string"&&(_.isArray(e)===!0?_.each(e,a=>{s[a.name]=new a.inyectar}):_.isObject(e)===!0?s[e.name]=new e.inyectar:s.push(e)),this.mainRegion=new y({el:this.el,...o}),this.currentSubapp=new t({region:this.mainRegion,services:s,App:this}),this.currentSubapp},confirmaApp(t){const{message:e,callback:o,title:s="¿Confirmar?",icon:a="warning"}=t;Swal.fire({title:s,text:e,icon:a,showCancelButton:!0,confirmButtonColor:"#2dce89",cancelButtonColor:"#fc8c72",confirmButtonText:"SI, Continuar!"}).then(n=>{o(n.isConfirmed)})},syncroRequest(t){const{url:e,data:o={},callback:s,silent:a=!1}=t,n=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({type:"POST",dataType:"json",url:e,data:o,cache:!1,contentType:"application/x-www-form-urlencoded",processData:!0,timeout:52400,beforeSend:i=>{a==!1&&r.show(),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.length>0&&i.setRequestHeader("Authorization","Bearer "+n)},success:i=>(a==!1&&r.hide(),s(i)),error:i=>{const l=_.keys(i);return a==!1&&r.hide(),_.indexOf(l,"responseText")!==-1?(console.log(i.responseText),this.trigger("alert:error",{message:i.responseText})):(console.log(i),this.trigger("alert:error",{message:i})),s(!1)}})},renderModal(t={}){const{title:e,view:o,options:s=!1}=t,a=$("#modalComponent");this.Modal||(this.Modal=new bootstrap.Modal(document.getElementById("modalComponent"),{keyboard:!0,backdrop:"static"})),a.find("#mdl_set_title").text(e),a.find("#mdl_set_footer").css("display","none"),s&&a.find(".modal-dialog").addClass(s.bootstrapSize),a.find("#mdl_set_body").html(o.render().$el),this.Modal.show(),s&&(this.Modal.on("hidden.bs.modal",n=>o.remove()),a.find(".close").addClass("d-none"))},closeModal(t){this.Modal&&(this.Modal.hide(),this.Modal=null),t&&t.remove()},url(t="",e=void 0){return this.kumbiaURL((e??"")+"/"+t)},kumbiaURL:t=>(_.isUndefined(t)===!0&&(t=""),C.path+t),ajaxKumbia(t={}){const{url:e,data:o={},callback:s,silent:a=!1}=t,n=document.querySelector("[name='csrf-token']").getAttribute("content");$.ajax({type:"POST",data:o,url:this.kumbiaURL(e),dataType:"html",processData:!0,contentType:"application/x-www-form-urlencoded",cache:!1,beforeSend:i=>{a==!1&&r.show(),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.length>0&&i.setRequestHeader("Authorization","Bearer "+n)}}).done(i=>(a==!1&&r.hide(),s(i))).fail(i=>(a==!1&&r.hide(),this.trigger("alert:error",{message:i.responseText}),s(!1))).always(()=>{a==!1&&r.hide()})},downLoadFile(t){const{url:e,filename:o}=t,s=document.createElement("a");s.href=this.kumbiaURL(e+"/"+o),s.download=o,console.log(s),s.click()},uploadFile(t){const{url:e,data:o,callback:s,silent:a=!1}=t;let n;o instanceof FormData?n=o:(n=new FormData,n.append(o.name,o.file));const i=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({url:e,type:"POST",dataType:"json",data:n,cache:!1,contentType:!1,processData:!1,beforeSend:l=>{a==!1&&r.show(),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.length>0&&l.setRequestHeader("Authorization","Bearer "+i)},success:l=>(a==!1&&r.hide(),s(l)),error:l=>{const w=_.keys(l);return console.log(l),a==!1&&r.hide(),_.indexOf(w,"responseText")!==-1?this.trigger("alert:error",{message:l.responseText}):this.trigger("alert:error",{message:l}),s(!1)}})}};(CODSER===void 0||CODSER===void 0||CODSER==="")&&(window.location.href=c.url("principal/index"));const g=function(){$.get(c.url("numeroCuposDisponibles/"+CODSER)).done(function(t){$("#showNumCupos").text(t.cupos)}).fail(function(t){return console.log(t.responseText),!1})},d=function(t){let e=$("#showRegistros"),o=_.template($("#tmp_registros").html()),s="";_.size(t)==0?e.html("<tr><td colspan='4'>No hay beneficiarios aptos para aplicar al producto.</td></tr>"):(_.each(t,function(a){s+=o(a)}),e.html(s))},T=function(){$.get(c.url("serviciosAplicados/"+CODSER)).done(function(t){t.success&&(_.size(t.data)>0&&$("#show_access_davivienda").fadeIn("fast"),d(t.data))}).fail(function(t){return console.log(t.responseText),!1})};$(()=>{c.initialize(),T(),setInterval(function(){g()},1e4),$(document).on("click",'button[toggle="aplica"]',t=>{t.preventDefault();var e=$(t.currentTarget);Swal.fire({title:"¡Confirmar!",html:"<p style='font-size:0.97rem'>¿Está seguro que desea aplicar al complemento nutricional?</p>",showCancelButton:!0,confirmButtonClass:"btn btn-sm btn-success",cancelButtonClass:"btn btn-sm btn-danger",confirmButtonText:"SI",cancelButtonText:"NO"}).then(function(o){if(o.value){let s={id:e.attr("data-cid"),docben:e.attr("data-docu"),codser:CODSER};$.ajax({method:"POST",url:c.url("aplicarCupo"),dataType:"JSON",cache:!1,data:s}).done(function(a){a.success?(d(a.beneficiarios),g(),Swal.fire({title:"Notificación OK",html:"<p class='text-left' style='font-size:1rem'>"+a.msj+"</p>",showCloseButton:!1,showConfirmButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continuar"}).then(function(n){n.value===!0&&setTimeout(function(){window.location.href="#"},100)})):(a.beneficiarios&&d(a.beneficiarios),Swal.fire({title:"Notificación Alerta",text:a.msj,icon:"warning",showConfirmButton:!1,showCloseButton:!0,timer:1e4}))}).fail(function(a){return console.log(a.responseText),!1})}})}),$(document).on("click",'button[toggle="buscar"]',t=>{t.preventDefault();var e=$(t.currentTarget);let o={id:e.attr("data-cid"),docben:e.attr("data-docu"),codser:CODSER};$.ajax({method:"POST",url:c.url("buscarCupo"),dataType:"JSON",cache:!1,data:o}).done(function(s){s.success&&Swal.fire({title:"Nota",html:"<p class='text-left' style='font-size:1rem'>"+s.msj+"</p>",showCloseButton:!1,showConfirmButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continuar"}).then(function(a){a.value===!0&&setTimeout(function(){window.location.href="#"},100)})}).fail(function(s){return console.log(s.responseText),!1})}),$(document).on("click",'button[toggle="copy"]',t=>{t.preventDefault();let o=$(t.currentTarget).attr("data-cid"),s=document.createElement("textarea");s.textContent=o;let a=document.getElementsByTagName("body")[0];a.appendChild(s),s.select(),document.execCommand("copy"),a.removeChild(s)})});
//# sourceMappingURL=CoberturaServicios.js.map
