var k=Object.defineProperty;var A=s=>{throw TypeError(s)};var S=(s,e,t)=>e in s?k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>S(s,typeof e!="symbol"?e+"":e,t);var h=(s,e,t)=>e.has(s)?A("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);var p,f,m,w;let b=(w=class{constructor(e={}){h(this,p,null);h(this,f,null);h(this,m,null);_.extend(this,e),this.currentViews=new Array,this.el=e.el}show(e){this.closeView(this.currentView),this.currentView=e,this.openView(e)}html(e){this.$el&&this.$el.html(e)}append(e){this.currentViews.push(e),this.ensureEl(),e.render(),this.$el.append(e.el),e.onShow&&e.onShow()}closeView(e){e&&e.remove&&e.remove()}openView(e){this.ensureEl(),e.render(),this.$el.html(e.el),e.onShow&&e.onShow()}ensureEl(){this.$el||(this.$el=$(this.el))}remove(){this.currentViews.length>0&&this.currentViews.forEach(e=>{this.closeView(e)}),this.closeView(this.currentView)}},p=new WeakMap,f=new WeakMap,m=new WeakMap,w);const r=(()=>{let s,e,t,i;return{hide:(n=!1)=>{n&&e.remove(),s&&t.remove(),s=void 0},show:(n=!1,a)=>{n&&(e=document.createElement("div"),e.setAttribute("id","loading_msj"),$(e).html("<div class='loading_msj'><p class='text-warning'>Procesando datos de busqueda...</p></div>"),document.getElementById("app").appendChild(e)),s||(i=_.template($("#tmp_loader").html()),t=document.createElement("div"),t.setAttribute("class","loader"),t.setAttribute("id","loader"),$(t).append(i()),document.body.appendChild(t),t.setAttribute("style","display:block"),_.isObject(a)===!0&&a.addClass&&$(".loader").addClass(a.addClass)),s=!0}}})(),y=$("[name='csrf-token']"),T={path:y.attr("path"),app:y.attr("app")},g={Models:{},Collections:{},router:null,currentSubapp:null,Modal:null,layout:null,el:null,mainRegion:null,startApp(s,e="",t=""){this.el=t,this.el===""&&(this.el="#contentView"),this.initialize(),this.router=new s,Backbone.history.start()||this.router.navigate(e,{trigger:!0})},initialize(){_.extend(this,Backbone.Events),["error","warning","success","info"].forEach(e=>{this.listenTo(this,`noty:${e}`,t=>this.notify(e,t)),this.listenTo(this,`alert:${e}`,t=>this.alert(e,t))}),this.listenTo(this,"confirma",this.confirmaApp),this.listenTo(this,"syncro",this.syncroRequest),this.listenTo(this,"ajax",this.ajaxKumbia),this.listenTo(this,"show:modal",this.renderModal),this.listenTo(this,"hide:modal",this.closeModal),this.listenTo(this,"down",this.downLoadFile),this.listenTo(this,"upload",this.uploadFile)},notify(s,e){this.showNoty(s,e.toString(),s==="error"?1e4:6e3)},alert(s,e){const{title:t="Notificación",message:i="Nota no hay respuesta de la solicitud",timer:o=8200}=e;this.showAlert(t,i,s,o)},showNoty(s,e,t){new Noty({text:e,layout:"topRight",theme:"relax",type:s,timeout:t}).show()},showAlert(s="",e="",t="",i){Swal.fire({title:s,html:e,icon:t,showConfirmButton:!1,confirmButtonText:"Continuar",timer:i})},startSubApplication(s,e,t={}){let i=[];return typeof e!="string"&&(_.isArray(e)===!0?_.each(e,o=>{i[o.name]=new o.inyectar}):_.isObject(e)===!0?i[e.name]=new e.inyectar:i.push(e)),this.mainRegion=new b({el:this.el,...t}),this.currentSubapp=new s({region:this.mainRegion,services:i,App:this}),this.currentSubapp},confirmaApp(s){const{message:e,callback:t,title:i="¿Confirmar?",icon:o="warning"}=s;Swal.fire({title:i,text:e,icon:o,showCancelButton:!0,confirmButtonColor:"#2dce89",cancelButtonColor:"#fc8c72",confirmButtonText:"SI, Continuar!"}).then(l=>{t(l.isConfirmed)})},syncroRequest(s){const{url:e,data:t={},callback:i,silent:o=!1}=s,l=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({type:"POST",dataType:"json",url:e,data:t,cache:!1,contentType:"application/x-www-form-urlencoded",processData:!0,timeout:52400,beforeSend:n=>{o==!1&&r.show(),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.length>0&&n.setRequestHeader("Authorization","Bearer "+l)},success:n=>(o==!1&&r.hide(),i(n)),error:n=>{const a=_.keys(n);return o==!1&&r.hide(),_.indexOf(a,"responseText")!==-1?(console.log(n.responseText),this.trigger("alert:error",{message:n.responseText})):(console.log(n),this.trigger("alert:error",{message:n})),i(!1)}})},renderModal(s={}){const{title:e,view:t,options:i=!1}=s,o=$("#modalComponent");this.Modal||(this.Modal=new bootstrap.Modal(document.getElementById("modalComponent"),{keyboard:!0,backdrop:"static"})),o.find("#mdl_set_title").text(e),o.find("#mdl_set_footer").css("display","none"),i&&o.find(".modal-dialog").addClass(i.bootstrapSize),o.find("#mdl_set_body").html(t.render().$el),this.Modal.show(),i&&(this.Modal.on("hidden.bs.modal",l=>t.remove()),o.find(".close").addClass("d-none"))},closeModal(s){this.Modal&&(this.Modal.hide(),this.Modal=null),s&&s.remove()},url(s="",e=void 0){return this.kumbiaURL((e??"")+"/"+s)},kumbiaURL:s=>(_.isUndefined(s)===!0&&(s=""),T.path+s),ajaxKumbia(s={}){const{url:e,data:t={},callback:i,silent:o=!1}=s,l=document.querySelector("[name='csrf-token']").getAttribute("content");$.ajax({type:"POST",data:t,url:this.kumbiaURL(e),dataType:"html",processData:!0,contentType:"application/x-www-form-urlencoded",cache:!1,beforeSend:n=>{o==!1&&r.show(),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.length>0&&n.setRequestHeader("Authorization","Bearer "+l)}}).done(n=>(o==!1&&r.hide(),i(n))).fail(n=>(o==!1&&r.hide(),this.trigger("alert:error",{message:n.responseText}),i(!1))).always(()=>{o==!1&&r.hide()})},downLoadFile(s){const{url:e,filename:t}=s,i=document.createElement("a");i.href=this.kumbiaURL(e+"/"+t),i.download=t,console.log(i),i.click()},uploadFile(s){const{url:e,data:t,callback:i,silent:o=!1}=s;let l;t instanceof FormData?l=t:(l=new FormData,l.append(t.name,t.file));const n=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({url:e,type:"POST",dataType:"json",data:l,cache:!1,contentType:!1,processData:!1,beforeSend:a=>{o==!1&&r.show(),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.length>0&&a.setRequestHeader("Authorization","Bearer "+n)},success:a=>(o==!1&&r.hide(),i(a)),error:a=>{const R=_.keys(a);return console.log(a),o==!1&&r.hide(),_.indexOf(R,"responseText")!==-1?this.trigger("alert:error",{message:a.responseText}):this.trigger("alert:error",{message:a}),i(!1)}})}};class u extends Backbone.View{constructor(t={modelDOM:null,onRender:null}){super(t);c(this,"modelDOM",null);this.modelDOM=t.modelDOM||Backbone.Model,this.template=null,_.extend(this,t),this.onRender=_.isFunction(this.onRender)?this.onRender:null}render(){const t=this.serializeData();let i;return _.isFunction(this.template)?i=this.template(t):_.isString(this.template)&&(i=this.compileTemplate()(t)),this.$el.html(i),this.onRender&&this.onRender(this.$el),this}compileTemplate(){if(_.isString(this.template)===!0){const t=document.querySelector(this.template);return _.template(t.innerHTML)}return!1}serializeData(){let t=null;return this.modelDOM!==null?this.model instanceof this.modelDOM?t=this.model.toJSON():typeof this.model=="object"&&(t=this.model):typeof this.model=="object"&&(t=this.model),t||{}}getInput(t){return this.$el.find(`[name='${t}']`).val()}getInputById(t){return this.$el.find("#"+t).val()}setInput(t,i){return this.$el.find(`[name='${t}']`).val(i??"")}getInputByTag(t,i){return this.$el.find(`[${t}='${i}']`).val()}getCheck(t){return this.$el.find(`[name='${t}']:checked`).length}getInputFile(t){return this.$el.find("#"+t).files[0]}}class x extends u{constructor(t={}){super(t);c(this,"tagRegions",{});c(this,"regionsLayout",{});_.extend(this,t)}render(){this.closeRegions();const t=u.prototype.render.call(this);return this.configureRegions(),t}configureRegions(){const t=this.tagRegions||{};this.regionsLayout||(this.regionsLayout={}),_.each(t,(i,o)=>{let l=this.$(i);this.regionsLayout[o]=new b({el:l})})}getRegion(t){return this.regionsLayout?this.regionsLayout[t]:!1}remove(t={}){this.stopListening(),this.closeRegions(),u.prototype.remove.call(this,t)}closeRegions(){if(!this.regionsLayout)return!1;_.each(this.regionsLayout,t=>{t&&t.remove&&t.remove()})}}class v extends x{constructor(e={}){super({...e,template:"#tmp_layout",tagRegions:e.regions||{afiliaciones:"#show_afiliaciones",productos:"#show_productos",consultas:"#show_consultas"}})}get events(){return{"click [data-toggle='linkFilter']":"linkFilter"}}}class d extends Backbone.View{constructor(e={}){super(e),this.tableView=void 0}get className(){return"col-xs-12 col-lg-3"}initialize(){this.template=document.getElementById("tmp_card").innerHTML}render(){const e=_.template(this.template),t=$("[name='csrf-token']").attr("path");return this.model.url=g.kumbiaURL(this.model.url),this.model.imagen=t+"img/Mercurio/"+this.model.imagen,this.$el.html(e(this.model)),this}get events(){return{}}remove(){this.stopListening(),Backbone.View.prototype.remove.call(this)}}class M{constructor(e){this.App=null,this.region=null,this.layout=null,_.extend(this,e),_.extend(this,Backbone.Events),this.once("syncro:request",this.__syncroSolicitudes),this.layout=new v,this.listenTo(this.layout,"form:cancel",this.destroy),this.region.show(this.layout)}listServices(){this.__validaSyncro(),this.__buscarServicios({callback:e=>{e&&(this.App.Collections.afiliacion&&_.each(this.App.Collections.afiliacion,t=>{t.tipo="afiliacion";const i=new d({model:t});this.layout.getRegion("afiliaciones").append(i)}),this.App.Collections.productos&&($("[for='productos']").fadeIn(),_.each(this.App.Collections.productos,t=>{t.tipo="productos";const i=new d({model:t});this.layout.getRegion("productos").append(i)})),this.App.Collections.consultas&&($("[for='consultas']").fadeIn(),_.each(this.App.Collections.consultas,t=>{t.tipo="consultas";const i=new d({model:t});this.layout.getRegion("consultas").append(i)})))},silent:!1})}descargaDocumentos(){}__buscarServicios(e){const{callback:t,silent:i}=e;this.App.trigger("syncro",{url:this.App.url("mercurio/servicios"),data:{},silent:i,callback:o=>o&&o.success===!0?(_.extend(this.App.Collections,o.data),t(o.msj)):t(!1)})}__syncroSolicitudes(){this.App.trigger("syncro",{url:this.App.url("mercurio/actualizaEstadoSolicitudes"),data:{},callback:e=>{e.success&&this.App.trigger("alert:success",{message:e.msj})}})}__validaSyncro(){this.App.trigger("syncro",{url:this.App.url("mercurio/valida_syncro"),data:{},callback:e=>{e.success&&(e.data.syncron&&this.trigger("syncro:request"),$("#show_date_syncron").html(e.data.ultimo_syncron))},silent:!0})}destroy(){this.stopListening(),this.region&&this.region instanceof Region&&this.region.remove()}}class C extends Backbone.Router{constructor(e={}){super({routes:{list:"listServices",doc:"descargaDocumentos"}}),_.extend(this,e),this._bindRoutes()}initialize(){this.currentApp=g.startSubApplication(M)}listServices(){this.currentApp.listServices()}descargaDocumentos(){this.currentApp.descargaDocumentos()}}$(()=>{g.startApp(C,"list","#boneLayout")});
//# sourceMappingURL=Principal.js.map
