var ae=Object.defineProperty;var J=s=>{throw TypeError(s)};var le=(s,e,t)=>e in s?ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var C=(s,e,t)=>le(s,typeof e!="symbol"?e+"":e,t),j=(s,e,t)=>e.has(s)||J("Cannot "+t);var o=(s,e,t)=>(j(s,e,"read from private field"),t?t.call(s):e.get(s)),a=(s,e,t)=>e.has(s)?J("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),l=(s,e,t,i)=>(j(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),u=(s,e,t)=>(j(s,e,"access private method"),t);var I,N,U;class X{constructor(e={}){a(this,I,null);a(this,N,null);a(this,U,null);_.extend(this,e),this.currentViews=new Array,this.el=e.el}show(e){this.closeView(this.currentView),this.currentView=e,this.openView(e)}html(e){this.$el&&this.$el.html(e)}append(e){this.currentViews.push(e),this.ensureEl(),e.render(),this.$el.append(e.el),e.onShow&&e.onShow()}closeView(e){e&&e.remove&&e.remove()}openView(e){this.ensureEl(),e.render(),this.$el.html(e.el),e.onShow&&e.onShow()}ensureEl(){this.$el||(this.$el=$(this.el))}remove(){this.currentViews.length>0&&this.currentViews.forEach(e=>{this.closeView(e)}),this.closeView(this.currentView)}}I=new WeakMap,N=new WeakMap,U=new WeakMap;const p=(()=>{let s,e,t,i;return{hide:(n=!1)=>{n&&e.remove(),s&&t.remove(),s=void 0},show:(n=!1,d)=>{n&&(e=document.createElement("div"),e.setAttribute("id","loading_msj"),$(e).html("<div class='loading_msj'><p class='text-warning'>Procesando datos de busqueda...</p></div>"),document.getElementById("app").appendChild(e)),s||(i=_.template($("#tmp_loader").html()),t=document.createElement("div"),t.setAttribute("class","loader"),t.setAttribute("id","loader"),$(t).append(i()),document.body.appendChild(t),t.setAttribute("style","display:block"),_.isObject(d)===!0&&d.addClass&&$(".loader").addClass(d.addClass)),s=!0}}})(),K=$("[name='csrf-token']"),ce={path:K.attr("path"),app:K.attr("app")},T={Models:{},Collections:{},router:null,currentSubapp:null,Modal:null,layout:null,el:null,mainRegion:null,startApp(s,e="",t=""){this.el=t,this.el===""&&(this.el="#contentView"),this.initialize(),this.router=new s,Backbone.history.start()||this.router.navigate(e,{trigger:!0})},initialize(){_.extend(this,Backbone.Events),["error","warning","success","info"].forEach(e=>{this.listenTo(this,`noty:${e}`,t=>this.notify(e,t)),this.listenTo(this,`alert:${e}`,t=>this.alert(e,t))}),this.listenTo(this,"confirma",this.confirmaApp),this.listenTo(this,"syncro",this.syncroRequest),this.listenTo(this,"ajax",this.ajaxKumbia),this.listenTo(this,"show:modal",this.renderModal),this.listenTo(this,"hide:modal",this.closeModal),this.listenTo(this,"down",this.downLoadFile),this.listenTo(this,"upload",this.uploadFile)},notify(s,e){this.showNoty(s,e.toString(),s==="error"?1e4:6e3)},alert(s,e){const{title:t="Notificación",message:i="Nota no hay respuesta de la solicitud",timer:r=8200}=e;this.showAlert(t,i,s,r)},showNoty(s,e,t){new Noty({text:e,layout:"topRight",theme:"relax",type:s,timeout:t}).show()},showAlert(s="",e="",t="",i){Swal.fire({title:s,html:e,icon:t,showConfirmButton:!1,confirmButtonText:"Continuar",timer:i})},startSubApplication(s,e,t={}){let i=[];return typeof e!="string"&&(_.isArray(e)===!0?_.each(e,r=>{i[r.name]=new r.inyectar}):_.isObject(e)===!0?i[e.name]=new e.inyectar:i.push(e)),this.mainRegion=new X({el:this.el,...t}),this.currentSubapp=new s({region:this.mainRegion,services:i,App:this}),this.currentSubapp},confirmaApp(s){const{message:e,callback:t,title:i="¿Confirmar?",icon:r="warning"}=s;Swal.fire({title:i,text:e,icon:r,showCancelButton:!0,confirmButtonColor:"#2dce89",cancelButtonColor:"#fc8c72",confirmButtonText:"SI, Continuar!"}).then(h=>{t(h.isConfirmed)})},syncroRequest(s){const{url:e,data:t={},callback:i,silent:r=!1}=s,h=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({type:"POST",dataType:"json",url:e,data:t,cache:!1,contentType:"application/x-www-form-urlencoded",processData:!0,timeout:52400,beforeSend:n=>{r==!1&&p.show(),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.length>0&&n.setRequestHeader("Authorization","Bearer "+h)},success:n=>(r==!1&&p.hide(),i(n)),error:n=>{const d=_.keys(n);return r==!1&&p.hide(),_.indexOf(d,"responseText")!==-1?(console.log(n.responseText),this.trigger("alert:error",{message:n.responseText})):(console.log(n),this.trigger("alert:error",{message:n})),i(!1)}})},renderModal(s={}){const{title:e,view:t,options:i=!1}=s,r=$("#modalComponent");this.Modal||(this.Modal=new bootstrap.Modal(document.getElementById("modalComponent"),{keyboard:!0,backdrop:"static"})),r.find("#mdl_set_title").text(e),r.find("#mdl_set_footer").css("display","none"),i&&r.find(".modal-dialog").addClass(i.bootstrapSize),r.find("#mdl_set_body").html(t.render().$el),this.Modal.show(),i&&(this.Modal.on("hidden.bs.modal",h=>t.remove()),r.find(".close").addClass("d-none"))},closeModal(s){this.Modal&&(this.Modal.hide(),this.Modal=null),s&&s.remove()},url(s="",e=void 0){return this.kumbiaURL((e??"")+"/"+s)},kumbiaURL:s=>(_.isUndefined(s)===!0&&(s=""),ce.path+s),ajaxKumbia(s={}){const{url:e,data:t={},callback:i,silent:r=!1}=s,h=document.querySelector("[name='csrf-token']").getAttribute("content");$.ajax({type:"POST",data:t,url:this.kumbiaURL(e),dataType:"html",processData:!0,contentType:"application/x-www-form-urlencoded",cache:!1,beforeSend:n=>{r==!1&&p.show(),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.length>0&&n.setRequestHeader("Authorization","Bearer "+h)}}).done(n=>(r==!1&&p.hide(),i(n))).fail(n=>(r==!1&&p.hide(),this.trigger("alert:error",{message:n.responseText}),i(!1))).always(()=>{r==!1&&p.hide()})},downLoadFile(s){const{url:e,filename:t}=s,i=document.createElement("a");i.href=this.kumbiaURL(e+"/"+t),i.download=t,console.log(i),i.click()},uploadFile(s){const{url:e,data:t,callback:i,silent:r=!1}=s;let h;t instanceof FormData?h=t:(h=new FormData,h.append(t.name,t.file));const n=document.querySelector("[name='csrf-token']").getAttribute("content");Backbone.ajax({url:e,type:"POST",dataType:"json",data:h,cache:!1,contentType:!1,processData:!1,beforeSend:d=>{r==!1&&p.show(),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.length>0&&d.setRequestHeader("Authorization","Bearer "+n)},success:d=>(r==!1&&p.hide(),i(d)),error:d=>{const ne=_.keys(d);return console.log(d),r==!1&&p.hide(),_.indexOf(ne,"responseText")!==-1?this.trigger("alert:error",{message:d.responseText}):this.trigger("alert:error",{message:d}),i(!1)}})}};class E extends Backbone.View{constructor(t={modelDOM:null,onRender:null}){super(t);C(this,"modelDOM",null);this.modelDOM=t.modelDOM||Backbone.Model,this.template=null,_.extend(this,t),this.onRender=_.isFunction(this.onRender)?this.onRender:null}render(){const t=this.serializeData();let i;return _.isFunction(this.template)?i=this.template(t):_.isString(this.template)&&(i=this.compileTemplate()(t)),this.$el.html(i),this.onRender&&this.onRender(this.$el),this}compileTemplate(){if(_.isString(this.template)===!0){const t=document.querySelector(this.template);return _.template(t.innerHTML)}return!1}serializeData(){let t=null;return this.modelDOM!==null?this.model instanceof this.modelDOM?t=this.model.toJSON():typeof this.model=="object"&&(t=this.model):typeof this.model=="object"&&(t=this.model),t||{}}getInput(t){return this.$el.find(`[name='${t}']`).val()}getInputById(t){return this.$el.find("#"+t).val()}setInput(t,i){return this.$el.find(`[name='${t}']`).val(i??"")}getInputByTag(t,i){return this.$el.find(`[${t}='${i}']`).val()}getCheck(t){return this.$el.find(`[name='${t}']:checked`).length}getInputFile(t){return this.$el.find("#"+t).files[0]}}var V,L,B,G,Q;class W{constructor(e={}){a(this,B);a(this,V,!0);a(this,L,!0);l(this,V,e.logErrors??!0),l(this,L,e.showUserMessages??!0)}handleError(e,t="Error desconocido"){o(this,V)&&console.error(`[${t}]:`,e),o(this,L)&&u(this,B,Q).call(this,u(this,B,G).call(this,e,t))}}V=new WeakMap,L=new WeakMap,B=new WeakSet,G=function(e,t){var i;return e instanceof TypeError?"Error de tipo de datos. Por favor, verifica que los datos sean válidos.":e instanceof ReferenceError?"Error de referencia. Algunos elementos de la página no se encontraron.":(i=e.message)!=null&&i.includes("fetch")?"Error de conexión. Por favor, verifica tu conexión a internet.":`${t}. Si el problema persiste, recarga la página.`},Q=function(e){const t=document.querySelector("#table-body");t?t.innerHTML=`
          <tr>
            <td colspan="8" class="text-center text-danger">
              <i class="fas fa-exclamation-triangle me-2"></i>
              ${e}
            </td>
          </tr>
        `:alert(e)};var k,g,D;const x=class x{constructor(){a(this,g,[]);a(this,D,1e3);if(o(x,k))return o(x,k);l(x,k,this)}log(e,t,i=null){const r={timestamp:new Date().toISOString(),level:e,message:t,data:i?this.structuredClone(i):null};o(this,g).push(r),o(this,g).length>o(this,D)&&l(this,g,o(this,g).slice(-o(this,D))),console.log(t,i)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t){this.log("error",e,t)}debug(e,t){this.log("debug",e,t)}getLogs(e=null){return e?o(this,g).filter(t=>t.level===e):[...o(this,g)]}clear(){l(this,g,[])}structuredClone(e){return JSON.parse(JSON.stringify(e))}};k=new WeakMap,g=new WeakMap,D=new WeakMap,a(x,k);let O=x;var H;class he extends E{constructor(t={}){super({...t,modelDOM:Backbone.Model});a(this,H);C(this,"logger");this.logger=new O,l(this,H,t.errorHandler||new W),this.template=_.template(document.getElementById("tmp_mora_presunta").innerHTML)}}H=new WeakMap;class ue extends E{constructor(t={}){super(t);C(this,"tagRegions",{});C(this,"regionsLayout",{});_.extend(this,t)}render(){this.closeRegions();const t=E.prototype.render.call(this);return this.configureRegions(),t}configureRegions(){const t=this.tagRegions||{};this.regionsLayout||(this.regionsLayout={}),_.each(t,(i,r)=>{let h=this.$(i);this.regionsLayout[r]=new X({el:h})})}getRegion(t){return this.regionsLayout?this.regionsLayout[t]:!1}remove(t={}){this.stopListening(),this.closeRegions(),E.prototype.remove.call(this,t)}closeRegions(){if(!this.regionsLayout)return!1;_.each(this.regionsLayout,t=>{t&&t.remove&&t.remove()})}}class de extends ue{constructor(e={}){super({...e,template:"#tmp_layout",className:"tab-content",tagRegions:{periodos:"#periodo-list",sucursales:"#sucursal-tabs",table:"#data-table"}})}}class me extends Backbone.View{initialize(){this.children={},this.listenTo(this.collection,"add",this.modelAdded),this.listenTo(this.collection,"remove",this.modelRemoved),this.listenTo(this.collection,"reset",this.render)}modelAdded(e){const t=this.renderModel(e);this.$el.append(t.$el)}modelRemoved(e){if(!e)return;const t=this.children[e.cid];this.closeChildView(t)}render(){this.closeChildren();const e=this.collection.map(t=>this.renderModel(t).$el);return this.$el.html(e),this}renderModel(e){const t=new this.modelView({model:e});return this.children[e.cid]=t,this.listenTo(t,"all",i=>{this.trigger("item:"+i,t,e)}),t.render(),t}remove(){Backbone.View.prototype.remove.call(this),this.closeChildren()}closeChildren(){const e=this.children||{};_.each(e,t=>this.closeChildView(t))}closeChildView(e){e&&(_.isFunction(e.remove)&&e.remove(),this.stopListening(e),e.model&&(this.children[e.model.cid]=void 0))}}class fe extends E{constructor(e={}){super(e),this.template=_.template('<button data-codsuc="<%= codsuc %>" class="btn btn-primary btn-sucursal <%= (isActive) ? "active" : "" %>"><%= codsuc %></button>')}}class pe extends me{constructor(e={}){super(e),this.modelView=fe}get events(){return{"click .btn-sucursal":"changeSucursal"}}changeSucursal(e){e.preventDefault();const t=e.currentTarget.dataset.codsuc;t&&this.trigger("change:sucursal",t)}}class ge extends Backbone.Model{}class we extends Backbone.Collection{constructor(e={}){super(e)}get model(){return ge}}class ye extends Backbone.View{constructor(e={}){super({...e,className:"list-group"})}render(){let e="";for(const t in this.collection){const i=this.collection[t];e+=`<a data-periodo="${i}" class='list-group-item list-group-item-action'>${i}</a>`}return this.$el.append(e),this.$(`.list-group-item[data-periodo="${this.collection.at(0)}"]`).addClass("active"),this}get events(){return{"click .list-group-item":"changePeriodo"}}changePeriodo(e){e.preventDefault();const t=e.currentTarget.dataset.periodo;t&&(this.$(e.currentTarget).addClass("active").siblings().removeClass("active"),this.trigger("change:periodo",t))}}var w,v,b,q,S,m,M,f,R,c,Y,Z,z,ee,te,se,F,ie;class be{constructor(){a(this,c);a(this,w);a(this,v);a(this,b);a(this,q);a(this,S);a(this,m);a(this,M);a(this,f);a(this,R);_.extend(this,Backbone.Events),l(this,v,new W),l(this,q,new O),l(this,S,new de)}setDataManager(e){l(this,w,e)}execute(e=null,t=null){u(this,c,Y).call(this),e&&l(this,m,e),t&&l(this,f,t)}destroy(){o(this,M).remove(),o(this,R).remove(),o(this,b).remove(),this.stopListening()}}w=new WeakMap,v=new WeakMap,b=new WeakMap,q=new WeakMap,S=new WeakMap,m=new WeakMap,M=new WeakMap,f=new WeakMap,R=new WeakMap,c=new WeakSet,Y=function(){try{u(this,c,Z).call(this)}catch(e){u(this,c,ee).call(this,e,"Error al inicializar la aplicación")}},Z=function(){new X({el:"#boneLayout"}).show(o(this,S)),u(this,c,te).call(this),u(this,c,se).call(this),u(this,c,z).call(this),u(this,c,F).call(this)},z=function(){o(this,b)&&o(this,b).remove(),l(this,b,new he({model:{codsuc:o(this,m),cartera:o(this,w).cartera[o(this,m)][o(this,f)],periodos:o(this,w).periodos,sucursales:o(this,w).sucursales},errorHandler:o(this,v)})),o(this,S).getRegion("table").show(o(this,b))},ee=function(e,t){o(this,q).error(t,e),o(this,v).handleError(e,t),T.trigger("alert:error",{message:`${t}: ${e.message||"Error desconocido"}`})},te=function(){let e;o(this,m)?e=_.map(o(this,w).sucursales,r=>(r.isActive=r.codsuc==o(this,m),r)):(e=_.map(o(this,w).sucursales,r=>(r.isActive=!1,r)),l(this,m,e[0].codsuc));const t=new we(e),i=o(this,S).getRegion("sucursales");l(this,R,new pe({collection:t})),this.listenTo(o(this,R),"change:sucursal",r=>{o(this,m)!=r&&(this.destroy(),setTimeout(()=>{T.router.navigate(`list/${r}`,{trigger:!0})},50))}),i.show(o(this,R))},se=function(){const e=o(this,S).getRegion("periodos"),t=_.filter(o(this,w).cartera,(r,h)=>h==o(this,m)?r:null),i=_.map(t,r=>Object.keys(r));o(this,f)||l(this,f,i[0][0]),l(this,M,new ye({collection:i[0]})),this.listenTo(o(this,M),"change:periodo",r=>{o(this,f)!=r&&(l(this,f,r),setTimeout(()=>{u(this,c,z).call(this),u(this,c,F).call(this)},50))}),e.show(o(this,M))},F=function(){const e=$("#view_mora_title");let t;o(this,f)?t=`Sucursal: ${o(this,m)} - Periodo: ${u(this,c,ie).call(this,o(this,f))}`:t=`Sucursal: ${o(this,m)}`,e.text(t)},ie=function(e){return!e||e.length!==6?e:`${e.substring(4,6)}/${e.substring(0,4)}`};var A,y,P,re,oe;class $e extends Backbone.Router{constructor(t={}){super({...t,routes:{list:"renderDefault","list/:sucursal":"renderBySucursal","list/:sucursal/:periodo":"renderBySucursalPeriodo"}});a(this,y);a(this,A);this.currentApp=T.startSubApplication(be),this._bindRoutes()}async renderBySucursalPeriodo(t,i){await u(this,y,P).call(this),this.currentApp.execute(t,i)}async renderBySucursal(t){await u(this,y,P).call(this),this.currentApp.execute(t)}async renderDefault(){await u(this,y,P).call(this),this.currentApp.execute()}}A=new WeakMap,y=new WeakSet,P=async function(){try{if(!o(this,A)){const t=await u(this,y,oe).call(this);l(this,A,t.data)}this.currentApp.setDataManager(o(this,A))}catch(t){throw u(this,y,re).call(this,t,"Error al cargar los datos"),t}},re=function(t,i){T.trigger("alert:error",{message:`${i}: ${t.message}`})},oe=function(){return new Promise((t,i)=>{T.trigger("syncro",{url:T.url("mora_presunta"),data:{},callback:r=>t(r),error:r=>i(r.message)})})};$(()=>{T.startApp($e,"list","#boneLayout")});
//# sourceMappingURL=MoraPresunta.js.map
